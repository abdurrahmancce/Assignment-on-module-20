{% extends 'blog/base.html' %}
{% block content %}
  <article>
    <h1>{{ post.title }}</h1>
    <p>By {{ post.author.username }} • {{ post.created_at|date:"M d, Y" }}</p>
    {% if post.featured_image %}
      <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" style="max-width: 100%; height: auto;">
    {% endif %}
    <div>{{ post.content|linebreaks }}</div>

    <p>Tags:
      {% for tag in post.tags.all %}
        <a href="{% url 'tag_list' tag.slug %}">#{{ tag.name }}</a>
      {% empty %}No tags{% endfor %}
    </p>

    <form action="{% url 'like_post' post.slug %}" method="post">
      {% csrf_token %}
      <button type="submit">{% if liked %}Unlike{% else %}Like{% endif %}</button>
      <span>{{ like_count }} Likes</span>
    </form>

    {% if user == post.author %}
      <p>
        <a href="{% url 'post_edit' post.slug %}">Edit</a> |
        <a href="{% url 'post_delete' post.slug %}">Delete</a>
      </p>
    {% endif %}
  </article>

  <section>
    <h3>Comments ({{ comments|length }})</h3>
    {% for c in comments %}
      <div>
        <strong>{{ c.user.username }}</strong> • {{ c.created_at|timesince }} ago
        <p>{{ c.body|linebreaks }}</p>
      </div>
    {% empty %}
      <p>No comments yet.</p>
    {% endfor %}
  </section>

  <section>
    <h3>Add a comment</h3>
    {% if user.is_authenticated %}
      <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
      </form>
    {% else %}
      <p>Please <a href="{% url 'login' %}">login</a> to comment.</p>
    {% endif %}
  </section>
{% endblock %}
